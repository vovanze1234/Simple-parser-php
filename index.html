<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Парсер цитат — demo</title>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#7dd3fc;
    --muted:#9aa6b2;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background: linear-gradient(180deg,#2f0b0b 0%, #2a0808 100%);
    color:#e6eef6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
  }

  .app{
    max-width:1100px;
    margin:0 auto;
  }

  header{
    display:flex;
    gap:16px;
    align-items:center;
    margin-bottom:20px;
  }
  .logo{
    width:56px;
    height:56px;
    border-radius:12px;
    background:linear-gradient(135deg,var(--accent),#60a5fa);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:#022;
    font-size:20px;
    box-shadow:0 6px 20px rgba(0,0,0,0.5);
  }
  h1{font-size:20px;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:13px}

  .controls{
    display:flex;
    gap:10px;
    margin:18px 0 26px;
    align-items:center;
  }

  .btn{
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    color:var(--accent);
    padding:10px 14px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    backdrop-filter: blur(6px);
  }
  .btn:active{transform:translateY(1px)}
  .btn.secondary{color:#cbd5e1;border:1px solid rgba(255,255,255,0.02)}
  .page-input{
    background:var(--glass);
    border:1px solid rgba(255,255,255,0.03);
    padding:8px 10px;
    border-radius:8px;
    width:86px;
    color:inherit;
  }


  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fill,minmax(260px,1fr));
    gap:16px;
  }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    padding:16px;
    border-radius:14px;
    min-height:120px;
    box-shadow: 0 8px 30px rgba(2,6,23,0.6);
  }
  .quote-text{
    font-size:15px;
    line-height:1.35;
    margin-bottom:12px;
    color:#dfeffd;
  }
  .quote-author{
    font-weight:600;
    font-size:13px;
    color:var(--accent);
    margin-bottom:10px;
  }
  .tags{display:flex;gap:8px;flex-wrap:wrap}
  .tag{
    font-size:12px;
    padding:6px 8px;
    border-radius:999px;
    background:rgba(255,255,255,0.02);
    color:var(--muted);
  }

  .meta{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:18px;
    color:var(--muted);
    font-size:13px;
  }

  .center{
    text-align:center;
    margin-top:18px;
  }

  .loader{
    width:36px;height:36px;border-radius:50%;
    border:4px solid rgba(255,255,255,0.06);
    border-top-color:var(--accent);
    animation:spin 1s linear infinite;
    margin: 12px auto;
  }
  @keyframes spin {to{transform:rotate(360deg)}}

  .error{
    color:#ffb4b4;
    background: rgba(255,20,20,0.03);
    padding:10px;
    border-radius:8px;
    border:1px solid rgba(255,20,20,0.06);
  }

  footer{margin-top:26px;color:var(--muted);font-size:13px;text-align:center}
  @media (max-width:520px){
    header{flex-direction:column;align-items:flex-start;gap:8px}
  }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">LV</div>
      <div>
        <h1>Парсер цитат</h1>
        <p class="lead">Источник: <strong>quotes.toscrape.com</strong></p>
      </div>
    </header>

    <div class="controls">
      <button id="reload" class="btn">Загрузить</button>
      <input id="page" class="page-input" type="number" min="1" value="1" />
      <button id="prev" class="btn secondary">◀ Prev</button>
      <button id="next" class="btn secondary">Next ▶</button>
      <div style="flex:1"></div>
      <div id="status" style="color:var(--muted);font-size:13px">—</div>
    </div>

    <div id="out" class="grid"></div>

    <div id="center" class="center"></div>

  </div>

<script>
(async function(){
  const out = document.getElementById('out');
  const center = document.getElementById('center');
  const status = document.getElementById('status');
  const pageInput = document.getElementById('page');
  const btnReload = document.getElementById('reload');
  const btnNext = document.getElementById('next');
  const btnPrev = document.getElementById('prev');

  let lastPage = 1;
  let hasNext = false;

  async function showLoader() {
    out.innerHTML = '';
    center.innerHTML = '<div class="loader" aria-hidden="true"></div>';
    status.textContent = 'Загрузка...';
  }
  function showError(text){
    out.innerHTML = '';
    center.innerHTML = '<div class="error">' + text + '</div>';
    status.textContent = 'Ошибка';
  }

  function render(quotes){
    center.innerHTML = '';
    out.innerHTML = '';
    if (!quotes || quotes.length === 0) {
      center.innerHTML = '<div class="error">Цитаты не найдены на этой странице.</div>';
      return;
    }
    for (const q of quotes) {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="quote-text">${escapeHtml(q.text)}</div>
        <div class="quote-author">— ${escapeHtml(q.author)}</div>
        <div class="tags">${q.tags.map(t => '<span class="tag">'+escapeHtml(t)+'</span>').join('')}</div>
      `;
      out.appendChild(card);
    }
  }

  function escapeHtml(s){
    return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
  }

  async function load(page=1){
    page = Math.max(1, parseInt(page) || 1);
    pageInput.value = page;
    showLoader();
    try {
      const res = await fetch('scrape.php?page=' + encodeURIComponent(page));
      const data = await res.json();
      if (!data.ok) {
        showError('Сервер вернул ошибку: ' + (data.error || JSON.stringify(data)));
        return;
      }
      render(data.quotes);
      lastPage = data.page || page;
      hasNext = !!data.has_next;
      status.textContent = `Страница ${lastPage}${hasNext ? ' — есть следующая' : ''}`;
      btnPrev.disabled = lastPage <= 1;
      btnNext.disabled = !hasNext;
    } catch (e) {
      showError('Сетевая ошибка: ' + e.message);
    }
  }

  btnReload.addEventListener('click', () => load(pageInput.value));
  btnNext.addEventListener('click', () => load(lastPage + 1));
  btnPrev.addEventListener('click', () => load(Math.max(1, lastPage -1)));
  pageInput.addEventListener('change', () => load(pageInput.value));
  pageInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') load(pageInput.value) });

  await load(1);
})();
</script>
</body>
</html>
